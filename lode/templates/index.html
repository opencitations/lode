<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <title>LODE 2.0</title>
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
</head>
<body>
    <div class="main">
<div class="row align-items-center submission-form-container">
    <div class="col-md-4">
        <img class="img-fluid" src="https://essepuntato.it/assets/img/lode/logo.png" alt="LODE logo">
    </div>
    <div class="col-md-8">
        <div class="submission-form">
            <form id="extractForm">
                
                <!-- Semantic Artefact Source -->
                <div class="mb-3">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-info-circle-fill info-icon" 
                            data-bs-toggle="popover" 
                            data-bs-placement="right"
                            data-bs-content="Provide either a URL or upload a file (RDF, OWL, Turtle, N-Triples, etc.)"
                            data-bs-trigger="hover focus"></i>
                        </div>
                                            
                        <div class="col">
                            <!-- URL Input with Floating Label -->
                            <div id="urlSection">
                                <div class="form-floating">
                                    <input 
                                        type="text" 
                                        class="form-control" 
                                        id="semanticArtefactUrl" 
                                        name="semantic_artefact_url" 
                                        placeholder="Semantic artefact URL"
                                    >
                                    <label for="semanticArtefactUrl">Semantic artefact URL<span class="text-danger">*</span></label>
                                </div>
                            </div>
                            
                            <!-- File Input (non supporta floating label nativamente) -->
                            <div id="fileSection" class="hide">
                                <input 
                                    class="form-control" 
                                    type="file" 
                                    id="semanticArtefactFile" 
                                    name="semantic_artefact_file"
                                    accept=".rdf,.owl,.ttl,.n3,.nt,.xml"
                                    style="height: calc(3.5rem + 2px); padding: 1rem 0.75rem;"
                                >
                            </div>
                        </div>
                        
                        <div class="col-auto">
                            <div class="toggle-switch" id="sourceToggle">
                                <div class="toggle-slider url-mode" id="toggleSlider"></div>
                                <span class="toggle-option active" data-mode="url">
                                    <i class="bi bi-link-45deg"></i> URL
                                </span>
                                <span class="toggle-option inactive" data-mode="file">
                                    <i class="bi bi-file-earmark-arrow-up"></i> File
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resource URI -->
                <div class="mb-3">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-info-circle-fill info-icon" 
                            data-bs-toggle="popover" 
                            data-bs-placement="right"
                            data-bs-content="Leave empty to extract all resources from the semantic artefact"
                            data-bs-trigger="hover focus"></i>
                        </div>
                        <div class="col">
                            <div class="form-floating">
                                <input 
                                    type="text" 
                                    id="resource" 
                                    name="resource"
                                    class="form-control"
                                    placeholder="http://example.org/MyResource"
                                >
                                <label for="resource">Resource URI <span class="text-muted">(optional)</span></label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Format Selection -->
                <div class="mb-3">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-info-circle-fill info-icon" 
                            data-bs-toggle="popover" 
                            data-bs-placement="right"
                            data-bs-content="Choose how to interpret the RDF graph (OWL, RDF, or SKOS)"
                            data-bs-trigger="hover focus"></i>
                        </div>
                        <div class="col">
                            <div class="form-floating">
                                <select id="readAs" name="read_as" class="form-select" required>
                                    {% for format in formats %}
                                        <option value="{{ format.value if format.value is defined else format }}">
                                            {{ format.name if format.name is defined else format }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <label for="readAs">Select a format<span class="text-danger">*</span></label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Language Code -->
                <div class="mb-3">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-info-circle-fill info-icon" 
                            data-bs-toggle="popover" 
                            data-bs-placement="right"
                            data-bs-content="Specify a language code (e.g., 'en', 'it', 'fr') to filter labels by language"
                            data-bs-trigger="hover focus"></i>
                        </div>
                        <div class="col">
                            <div class="form-floating">
                                <input 
                                    type="text" 
                                    id="language" 
                                    name="language"
                                    class="form-control"
                                    placeholder="en"
                                    maxlength="5"
                                >
                                <label for="language">Language code <span class="text-muted">(optional)</span></label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" id="submitBtn">
                    Generate Documentation
                </button>
            </form>
        </div>
    </div>
</div>
        <div class="lode-documentation row p-5">
            <p>Live <a href="http://www.github.com/essepuntato/LODE">OWL Documentation Environment</a> (LODE) is a service that automatically extracts classes, object properties, data properties, named individuals, annotation properties, general axioms and namespace declarations from an OWL and OWL2 ontology, and renders them as ordered lists, together with their textual definitions, in a human-readable HTML page designed for browsing and navigation by means of embedded links.</p>
            <p>This LODE service is an open source development, and can be freely used, as described in this document. It may be used in conjunction with content negotiation to display this human-readable version of an OWL ontology when the user accesses the ontology using a web browser, or alternatively to deliver the OWL ontology itself when the user accesses the ontology using an ontology editing tool such as Protégé and NeOn Toolkit. An exemplar implementation of such content negotiation is given in the Best Practice Recipes for Publishing RDF Vocabularies by using the .htaccess file:</p>
            <pre>
AddType application/rdf+xml .rdf

# Rewrite engine setup
RewriteEngine On
            
# Rewrite rule to serve HTML content
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
<span style='font-weight: 600;'>RewriteRule ^ontology\$ https://w3id.org/lode/http://www.mydomain.com/ontology [R=303,L]</span>

# Rewrite rule to serve RDF/XML content if requested
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^ontology\$ ontology.owl [R=303]

# Choose the default response
RewriteRule ^ontology\$ ontology.owl [R=303]
            </pre>
        </div>
    </div>
    <script>
        // Initialize all popovers
        const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]');
        const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl));
        
        // Custom Toggle Switch Logic
        const sourceToggle = document.getElementById('sourceToggle');
        const toggleSlider = document.getElementById('toggleSlider');
        const toggleOptions = document.querySelectorAll('.toggle-option');
        const urlSection = document.getElementById('urlSection');
        const fileSection = document.getElementById('fileSection');
        const urlInput = document.getElementById('semanticArtefactUrl');
        const fileInput = document.getElementById('semanticArtefactFile');

        let isFileMode = false;

        sourceToggle.addEventListener('click', (e) => {
            // Toggle mode
            isFileMode = !isFileMode;

            if (isFileMode) {
                // Switch to File mode
                toggleSlider.classList.remove('url-mode');
                toggleSlider.classList.add('file-mode');
                toggleOptions[0].classList.remove('active');
                toggleOptions[0].classList.add('inactive');
                toggleOptions[1].classList.remove('inactive');
                toggleOptions[1].classList.add('active');
                
                urlSection.classList.add('hide');
                fileSection.classList.remove('hide');
                urlInput.value = '';
            } else {
                // Switch to URL mode
                toggleSlider.classList.remove('file-mode');
                toggleSlider.classList.add('url-mode');
                toggleOptions[1].classList.remove('active');
                toggleOptions[1].classList.add('inactive');
                toggleOptions[0].classList.remove('inactive');
                toggleOptions[0].classList.add('active');
                
                urlSection.classList.remove('hide');
                fileSection.classList.add('hide');
                fileInput.value = '';
            }
        });
        
    // Form submission
    const form = document.getElementById('extractForm');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // Rimuovi eventuali classi di errore precedenti
        urlInput.classList.remove('is-invalid');
        fileInput.classList.remove('is-invalid');
        
        // URL → GET
        if (!isFileMode) {
            const url = urlInput.value.trim();
            if (!url) {
                urlInput.classList.add('is-invalid');
                return;
            }
            
            const readAs = document.getElementById('readAs').value;
            const resource = document.getElementById('resource').value.trim();

            // Nel blocco GET (URL mode)
            const language = document.getElementById('language').value.trim();

            const params = new URLSearchParams({
                read_as: readAs,
                semantic_artefact_url: url
            });

            // language param handler
            if (language) {
                params.append('language', language);
            }
            
            if (resource) {
                params.append('resource', resource);
            }
            
            window.location.href = `/api/view?${params.toString()}`;
            return;
        }
        
        // FILE → POST
        const formData = new FormData();
        formData.append('read_as', document.getElementById('readAs').value);
        
        const resource = document.getElementById('resource').value.trim();
        if (resource) {
            formData.append('resource', resource);
        }
        
        const file = fileInput.files[0];
        if (!file) {
            fileInput.classList.add('is-invalid');
            return;
        }
        formData.append('semantic_artefact_file', file);

        // language param handler
        const language = document.getElementById('language').value.trim();
        if (language) {
            formData.append('language', language);
        }
            
        submitBtn.disabled = true;
        submitBtn.textContent = 'Processing...';
        
        try {
            const response = await fetch('/api/view', {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                throw new Error('Request failed');
            }
            
            const html = await response.text();
            document.open();
            document.write(html);
            document.close();
            
        } catch (error) {
            fileInput.classList.add('is-invalid');
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Generate Documentation';
        }
    });

    // Removes the red border when user start typing
    urlInput.addEventListener('input', () => {
        urlInput.classList.remove('is-invalid');
    });

    fileInput.addEventListener('change', () => {
        fileInput.classList.remove('is-invalid');
    });
    </script>
</body>
</html>